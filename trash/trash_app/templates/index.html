{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <p id="text"></p>
    <img id="myImage" src="{% static 'photo.jpg' %}" alt="" width="300">

</body>
<script>
    const output = document.getElementById("text");
    const image = document.getElementById("myImage");

    let milliseconds = 3000;  // Interval to refresh
    setInterval(reFetch, milliseconds);
    let iteration = 0;
    let res = "";

    function reFetch() {
        fetch("../api")
            .then((response) => response.json())
            .then(response => {
                // Update text if it has changed
                if (response.text !== res) {
                    res = response.text;
                    output.innerHTML = res;
                    iteration = 0;
                }

                // Refresh the image by updating the `src` with a timestamp to avoid caching
                const timestamp = new Date().getTime();  // Unique timestamp for cache busting
                image.src = "{% static 'photo.jpg' %}?timestamp=" + timestamp;

            }).catch(error => console.error('Error fetching data:', error));

        console.log(iteration);
        iteration++;
    }

</script>
</html>